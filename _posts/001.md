---
title: 'タグを関連付けるアルゴリズム？'
description: 'ウェブサイトのタグやカテゴリーを表示させるあれこれに関して'
tags: ["投稿", "テスト"]
datePublished: '2021-06-05T14:40:34+09:00'
dateModified: '2021-07-08T15:59:23+09:00'
code: true
---


- 記事が持っているタグのリスト
- タグが持っている記事のリスト

とある記事のページのファイルがタグのデータを持っているならば、タグに紐づく記事一覧を表示できる。

しかし、markdown作成時の段階でわかるのは、各ページが何のタグを持っているかということだけであり、各タグに紐づくのがどのページかまではわからない。

たとえば、Radiohead のページにつけられたタグ（ないしはカテゴリー）が rock と uk だとして、他の rock に所属するページはどうやって表示させれば良いのだろうか？

``` javascript
// それぞれのページが保有するタグ
tag-belong-to-page = {
  "beatles": ["rock", "uk"]
  "radiohead": ["rock", "uk", "alternative"]
  "nirvana": ["rock", "us", "alternative"]
  "velvet-underground": ["rock", "us", "alternative"]
  "sonic-youth": ["rock", "us", "alternative"]
}
// それぞれのタグが保有するページ
page-belong-to-tag = {
  "rock": ["beatles", "radiohead", "nirvana", "velvet-underground", "sonic-youth"],
  "alternative": ["radiohead", "nirvana", "velvet-underground", "sonic-youth"],
  "us": ["nirvana", "velvet-underground", "sonic-youth"],
  "uk": ["beatles", "radiohead"],
}
```

なんだかめんどくさそうだ。ループしまくる方法しか思いつかない。

今のところ、build するときに全ページのタイトルや url、 ページの内容から何から何まで突っ込んだ json ファイルを用意して、そこから引っ張ってくることにしている。

Radiohead が uk なのはわかっている。Radioheadのページファイルは自分が uk 所属であることを知っている。

だから uk というキーワードを使って 全ページ分データから仲間を探しに行く。見つかったら表示させる。

お察しの通り、1つのページに所属するタグが1つとは限らないし、1つのタグに所属するページも複数あったりする。

しかも最初に使う「Radiohead は uk ですよ」という情報ですら、1回全ページデータへアクセスしなければ取得できない。

これはループにループを重ねているので遅いと思う。わかっている。わかっているんだ。

## 事前にやるのか後でやるのか

go の自家製 cms で、build の際にタグページも全部作るやり方でやったら500ページで4秒かかってしまう。for が何回も出てくるとはいえ、やり方が悪いのだろう。

一旦記事ページを総ざらししてそれぞれのタグを拾った後、今度はそれぞれのタグに当てはまる他の記事ページはどれかな？という工程が必要なのだから仕方ないのかもしれない。

こういうときこそアルゴリズム？を工夫するとなんとかなりそう。

しかし、特になんの工夫もせずほぼストレートにページを生成する（markdown→html）のであれば、0コンマ何秒...というか build したのか気づかないくらい速い。

さらに、タグページは javascript で表示させてしまうほうが今のところは手軽に感じている。事前生成が良いのだろうけれど。うまい方法が思いつかない。

### 本当に必要なのか

これまでタグページというのはあまり注目してこなかった。他人のブログを見ていてもタグクラウドなどクリックする気が起きなかった。

しかし、scrapbox を使うようになってからというもの、タグが気になって仕方がない。見せ方次第で、繋げ方次第でこんなに違うものかと驚愕している。

